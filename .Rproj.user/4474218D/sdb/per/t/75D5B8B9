{
    "contents" : "# Pick out the appropriate variables\n\nsat10 <- sotc10$QCE1\nsat9 <- sotc09$QCE1\nsat8 <- sotc08$QCE1\nsat10 <- factor(sat10, levels(sat10)[c(5, 1:3, 4)])\nsat9 <- factor(sat9, levels(sat9)[c(5, 1:3, 4)])\nsat8 <- sat8[sat8 != \"(DK)\" & sat8 != \"(Not applicable)\" & sat8 !=\"(Refused)\"]\nsat8 <- factor(sat8)\nsat8 <- factor(sat8, levels(sat9)[c(5, 1:3, 4)])\n\n# Which factor levels are positive?\nneutral <- c(\"3\")\npositive <- c(\"Extremely satisfied\", \"4\")\nnegative <- c(\"2\", \"Not at all satisfied\")\n\n\n\n\ndfall <- data.frame()\n# Did this by hand because writing the correct loop would have been annoying\ntmp <- data.frame(Year=\"2010\", prop.table(table(sat10)))\nnames(tmp) <-c(\"Year\", \"Response\", \"Freq\")\ndfall <- rbind(dfall, tmp)\nnames(dfall) <- c(\"Year\", \"Response\", \"Freq\")\ndfall$Response <- factor(dfall$Response, levels=levels(dfall$Response)[c(4:1, 5)])\n\nneu <- dfall[dfall$Response==\"3\",]\nneu$Freq <- neu$Freq/2\n\npos <- dfall[dfall$Response %in% positive,]\npos <- rbind(pos, neu)\nneg <- dfall[dfall$Response %in% negative,]\nneg <- rbind(neg, neu)\nneg$Freq <- -neg$Freq\nneg$Response <- factor(neg$Response)\nneg$Response <- factor(neg$Response, levels=rev(levels(neg$Response)))\npos$Response <- factor(pos$Response)\npos$Response <- factor(pos$Response, levels=levels(pos$Response)[c(2,1,3)])\n\n\nbaseplot <- ggplot(dfall) + aes(Year, Freq, fill = Response, order=Response)\nbaseplot <- baseplot  +geom_bar(data = neg, stat = \"identity\") + geom_bar(data = pos, stat = \"identity\")\nbaseplot <- baseplot +coord_flip() + ggtitle(\"Community satisfaction over time\") + xlab(\"\") +ylab(\"\")\nbaseplot <- baseplot + scale_y_continuous(breaks=seq(from=-0.3, to=0.9, by=0.15), labels=percent)\nbaseplot\n\nbaseplot <- ggplot(sotc) + aes(citystate, fill=community_sat) +geom_bar()\n\n# What about by community in 2010\nneutral <- c(\"3\")\npositive <- c(\"Extremely satisfied\", \"4\")\nnegative <- c(\"2\", \"Not at all satisfied\")\n\n\n\ndfall <- data.frame()\nfor (i in 1:length(levels(sotc10$QSB))){\n  tmp <- data.frame(citystate=levels(sotc10$QSB)[i], prop.table(table(sotc10[sotc10$QSB==levels(sotc10$QSB)[i],]$QCE1)))\n  dfall <- rbind(dfall, tmp)\n}\nnames(dfall) <- c(\"citystate\", \"Response\", \"Freq\")\n\ndfall$Response <- factor(dfall$Response, levels=levels(dfall$Response)[c(5, 1:3, 4)])\n\n\nordering <- 0\nfor (i in 1:length(levels(dfall$citystate))){\n  ordering[i] <- sum(dfall[dfall$citystate==levels(dfall$citystate)[i] & dfall$Response != \"Not at all satisfied\" & dfall$Response != \"2\" & dfall$Response != \"3\",]$Freq)\n  ordering[i] <- ordering[i] + (dfall[dfall$citystate==levels(dfall$citystate)[i] & dfall$Response == \"3\",]$Freq/2)\n}\n\n\ndfall$citystate <- factor(dfall$citystate, levels=levels(dfall$citystate)[order(ordering)])\n\n\n\n\nneu <- dfall[dfall$Response==\"3\",]\nneu$Freq <- neu$Freq/2\npos <- dfall[dfall$Response %in% positive,]\npos <- rbind(pos, neu)\nneg <- dfall[dfall$Response %in% negative,]\nneg <- rbind(neg, neu)\nneg$Freq <- -neg$Freq\nneg$Response <- factor(neg$Response)\nneg$Response <- factor(neg$Response, levels=rev(levels(neg$Response)))\npos$Response <- factor(pos$Response)\n\n\n                          \nbaseplot <- ggplot(dfall) + aes(citystate, Freq, fill = Response, order=Response)\nbaseplot <- baseplot  +geom_bar(data = neg, stat = \"identity\") + geom_bar(data = pos, stat = \"identity\")\nbaseplot <- baseplot +coord_flip() + ggtitle(\"Community satisfaction in 2010\") + xlab(\"\") +ylab(\"\")\nbaseplot <- baseplot + scale_y_continuous(breaks=seq(from=-0.5, to=0.75, by=0.25), labels=percent)\nbaseplot",
    "created" : 1375483632054.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4225535338",
    "id" : "75D5B8B9",
    "lastKnownWriteTime" : 1375309655,
    "path" : "~/Dropbox/RStudioStuff/RStudioStuff/WorkingDocuments/SoulOfCommunity/CommunitySat.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}